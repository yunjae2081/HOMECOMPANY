<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="store.dao.StoreDAO">	
	
<!-- 	인기순 무한 스크롤 -->
	<select id="selectBestExtend" resultType="videobestlistvo">
		<![CDATA[
		select @rownum:=@rownum+1 as listNo, t.no as bestNo, t.name as fileName, t.con as content, t.title as title
      from (select @rownum:=0 order by @rownum) tmp, (select v.L_NO as no, sum(v.v_HITS) as hits, v.I_REAL_FILE_NAME as name, l.L_CONTENT as con, l.L_TITLE as title
  																											from tbl_video v, tbl_lecture l
												   														 where v.L_NO = l.L_NO
												   														 group by v.L_NO
												  														having min(S_NO)
											       													 order by hits desc, no) as t
			limit #{no}, 8;											       												
		]]>
	</select>
	
<!-- 	인기순 리스트 -->
	<select id="selectBestList" resultType="videobestlistvo">
		<![CDATA[
		select @rownum:=@rownum+1 as listNo, t.no as bestNo, t.name as fileName, t.con as content, t.title as title
      from (select @rownum:=0 order by @rownum) tmp, (select v.L_NO as no, sum(v.v_HITS) as hits, v.I_REAL_FILE_NAME as name, l.L_CONTENT as con, l.L_TITLE as title
  																											from tbl_video v, tbl_lecture l
												   														 where v.L_NO = l.L_NO
												   														 group by v.L_NO
												  														having min(S_NO)
											       													 order by hits desc, no) as t
			limit 0, 16;											       												
		]]>
	</select>
	
<!-- 	검색을 통한 리스트 -->
	<select id="selectNormalList" resultType="videobestlistvo" parameterType="String">
		<![CDATA[
		select ta.listNo as listNo, ta.bestNo as bestNo, ta.fileName as fileName, ta.content as content, ta.title as title         
			from (select @rownum:=@rownum+1 as listNo, t.no as bestNo, t.name as fileName, t.con as content, t.title as title
     				  from (select @rownum:=0 order by @rownum) tmp, (select v.L_NO as no, sum(v.v_HITS) as hits, v.I_REAL_FILE_NAME as name, l.L_CONTENT as con, l.L_TITLE as title
  																															from tbl_video v, tbl_lecture l
												   														 				 where v.L_NO = l.L_NO
												   														 				 group by v.L_NO
												  																		having min(S_NO)
											       													 				 order by hits desc, no) as t) ta
     where ta.title like CONCAT('%', #{title}, '%')										       												
		]]>
	</select>
	
	<!-- 	최신순 리스트 -->
	<select id="selectLatestList" resultType="videolatestlistvo">
		<![CDATA[
		select v.L_NO as latestNo, l.l_reg_date as date, v.I_REAL_FILE_NAME as fileName, l.L_CONTENT as content, l.L_TITLE as title
      from tbl_video v, tbl_lecture l
     where v.L_NO = l.L_NO
     group by v.L_NO
    having min(S_NO)
     order by date , latestNo
		 limit 0, 16;											       												
		]]>
	</select>
	
	<!-- 	최신순 무한 스크롤 -->
	<select id="selectLatestExtend" resultType="videolatestlistvo">
		<![CDATA[
		select v.L_NO as latestNo, l.l_reg_date as date, v.I_REAL_FILE_NAME as fileName, l.L_CONTENT as content, l.L_TITLE as title
      from tbl_video v, tbl_lecture l
     where v.L_NO = l.L_NO
     group by v.L_NO
    having min(S_NO)
     order by date , latestNo
			limit #{no}, 8;											       												
		]]>
	</select>
	
	
	<!-- store 디테일 상품정보 -->
	<select id="selectStoreDetail" parameterType="int" resultType="productvo">
		select p_no as pNo , l_no as lNo, p_id as pId, p_name as pName, 
				p_content as pContent, p_price as pPrice, p_count as pCount, p_reg_date as pRegDate
			from tbl_product
			where p_no = #{no}
	</select>
	
	<!-- store 디테일 이미지(4장) -->
	<select id="selectStoreImg" parameterType="int" resultType="productImgvo"> 
		select l_no as lNo, p_no as pNo, org_file_name as orgFileName, real_file_name as RealFileName, file_path as FilePath
			from tbl_product_img
			where p_no = #{no}
	</select>
	
	<!-- store 디테일 강의명 -->
	<select id="selectLectureName" parameterType="int" resultType="String">
		select l.L_TITLE
  			from tbl_lecture l, tbl_product p
 			where l.L_NO = p.L_NO and p.p_no = #{no}
	</select>
	
	<!-- store 디테일 카테고리명 -->
	<select id="selectCategoryName" parameterType="int" resultType="String">
		select cate_name
  			from tbl_category
 			where l_category = (select l.L_CATEGORY
                  				from tbl_lecture l, tbl_product p
                 				where l.L_NO = p.L_NO and p.p_no = #{no})
	</select>
	
	
</mapper>