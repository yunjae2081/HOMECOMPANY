<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="store.dao.StoreDAO">		
	
	<!-- store 디테일 상품정보 -->
	<select id="selectStoreDetail" parameterType="int" resultType="productvo">
		select p_no as pNo , l_no as lNo, p_id as pId, p_name as pName, 
				p_content as pContent, p_price as pPrice, p_count as pCount, p_reg_date as pRegDate
			from tbl_product
			where p_no = #{no}
	</select>
	
	<!-- store 디테일 이미지(4장) -->
	<select id="selectStoreImg" parameterType="int" resultType="productImgvo"> 
		select l_no as lNo, p_no as pNo, org_file_name as orgFileName, real_file_name as RealFileName, file_path as FilePath
			from tbl_product_img
			where p_no = #{no}
	</select>
	
	<!-- store 디테일 강의명 -->
	<select id="selectLectureName" parameterType="int" resultType="String">
		select l.L_TITLE
  			from tbl_lecture l, tbl_product p
 			where l.L_NO = p.L_NO and p.p_no = #{no}
	</select>
	
	<!-- store 디테일 카테고리명 -->
	<select id="selectCategoryName" parameterType="int" resultType="String">
		select cate_name
  			from tbl_category
 			where l_category = (select l.L_CATEGORY
                  				from tbl_lecture l, tbl_product p
                 				where l.L_NO = p.L_NO and p.p_no = #{no})
	</select>
	
	
<!-- 	스토어 버튼을 통한 진입 -->
	<select id="selectStoreList" resultType="storelistvo">
		 select @rownum:=@rownum+1 as listNo, t.name as name, t.price as price, t.content as content, t.fileName as fileName
			 from (select @rownum:=0 order by @rownum) tmp, (select p.P_NAME as name, p.P_PRICE as price, p.P_CONTENT as content, i.REAL_FILE_NAME as fileName
  																											 from tbl_product p, tbl_product_img i
 																												where p.P_NO = i.P_NO
 																												group by p.P_NO
 																												order by p.P_CLICK desc, p.P_NO) as t
	</select>
	
<!-- 	스토어 최신순 -->
	<select id="selectLatestList" resultType="storelistvo">
		select @rownum:=@rownum+1 as listNo, t.name as name, t.price as price, t.content as content, t.fileName as fileName
			 from (select @rownum:=0 order by @rownum) tmp, (select p.P_NAME as name, p.P_PRICE as price, p.P_CONTENT as content, i.REAL_FILE_NAME as fileName
  																											 from tbl_product p, tbl_product_img i
 																												where p.P_NO = i.P_NO
 																												group by p.P_NO
 																												order by p.P_REG_DATE desc, p.P_NO) as t
	</select>
	
	
</mapper>